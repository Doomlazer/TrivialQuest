<!DOCTYPE html>
<html>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<style type="text/css">
@font-face {
    font-family: SQ3font;
    src: url(fonts/LSL3n004I.ttf);
}

* {
    font-family: SQ3font;
    font-size: 30px;
    box-sizing: border-box;
}
.butt {
    font-size: 16px;
    font-family: "arial";
}
</style>
<body onload="start()">

<script type="text/javascript" src="./js/main.js"></script>
<script type="text/javascript" src="./js/lang.js"></script>
<script type="text/javascript" src="./js/util.js"></script>

<canvas id="myCanvas" width="640" height="458" style="border:1px solid #d3d3d3; cursor: url(img/Cursor999.cur), default;">
Your browser does not support the HTML5 canvas tag.</canvas>
<img id="title" src="img/title.png" width="642" height="458" hidden>
<img id="maskEN" src="img/lsl3/mask.png" width="642" height="458" hidden>
<img id="maskFR" src="img/lsl3/maskFR.png" width="642" height="458" hidden>
<img id="maskGR" src="img/lsl3/maskGR.png" width="642" height="458" hidden>
<img id="background" src="img/lsl3/background.png" width="642" height="458" hidden>
<img id="counter" src="img/misc/counter.bmp" width="191" height="219" hidden>
<img id="kQuestions" src="img/kQuestions/background.png" width="642" height="458" hidden>
<img id="rockSide" src="img/kQuestions/rockSide51x57.png" hidden>
<img id="pq2bkgrnd" src="img/pq2Mug/pq2bkgrnd.png" width="642" height="458" hidden>
<img id="pq2mug" src="img/pq2Mug/pq2mug.png" width="312" height="52" hidden>
<img id="lsl1vgabkgrnd" src="img/lsl1vga/lsl1vgabkgrnd.png" width="642" height="458" hidden>
<img id="sq3bkgrnd" src="img/sq3/sq3bkgrnd.png" width="642" height="458" hidden>
<img id="sq3grind" src="img/sq3/sq3grind.png" width="180" height="15" hidden>

<script>
var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");
//ctx.scale(2, 2);
var mode = 0; // 0 = title, 1 = lsl3, 2 = OpenTrivia, 3 = Kings questions, 
              // 4 = pq2Mugshots, 5 = lsl1vga, 6 = sq3
var mask = document.getElementById("maskEN");
var cNumImg = document.getElementById("counter");
var kQShipImg = document.getElementById("rockSide");
var shipMode = 0;
var shipCel = 0;
var mugCel = 0;
var mugArray = ["BAINS", "COLBY", "DICKEY", "GRANANDEZ", "JONES",
                "SIMMS", "SNIDER", "TASELLI"];
var mugStr = "";
var grindCel = 0;
var bkgnd;
var xPosition;
var yPosition;
var score = 0;
var rightAns; 
var ans = 0; // player's answer
var jsonData;
var splitData;
var questionJson;
var q;
var qSpacing = 75;
var qBaseNum = 150;
var nxt = 0;
var lang = "EN";
var langNum = 1;
var langLock = 0;
let r;
let ansArray = [];
let wrapLen = 30; //32;
let prevSong = -1;
var animateIntervalID;
var animationSpeed = 100;
var counterArray = [0,0,0,0,0,0]; // [c1x,c1y,c2x,c2y,c3x,c3y]
const myAudio = document.createElement("audio");
//var textUpperLim = 166; // lsl3 text file numbers
//var textLowerLim = 141;
var mode1Arr = [], mode3Arr = [], mode4Arr = [], mode5Arr = [];
var mode1JArr = [], mode5JArr = [];
var mode1I = 0, mode3I = 0, mode4I = 0, mode5I = 0, mode6I = 0;
var mode1J = 0, mode5J = 0;
var modeCompletionBonus = [0, 200, 0, 50, 300, 400];
var notPerfect = 0; 

function start() {
    ctx.imageSmoothingEnabled = false;
    ctx.font = "26px SQ3font";

    // randomize question arrays
    // lsl3 141-166 with five questions each
    for (let i = 141; i < 167; i++) {
        mode1Arr.push(i);
    }
    mode1Arr = shuffle(mode1Arr);
    for (let i = 0; i < 5; i++) {
        mode1JArr.push(i);
    }
    mode1JArr = shuffle(mode1JArr);
    // kings questions 0-41 files, one question each
    for (let i = 0; i < 42; i++) {
        mode3Arr.push(i);
    }
    mode3Arr = shuffle(mode3Arr);
    // pqMugs 8 images
    for (let i = 0; i < 8; i++) {
        mode4Arr.push(i);
    }
    mode4Arr = shuffle(mode4Arr);
    // lsl1vga 721-752 with five questions each
    for (let i = 721; i < 753; i++) {
        mode5Arr.push(i);
    }
    console.log("mode5Arr: " + mode5Arr);
    mode5Arr = shuffle(mode5Arr);
    console.log("shuffled mode5Arr: " + mode5Arr);
    for (let i = 0; i < 5; i++) {
        mode5JArr.push(i);
    }
    mode5JArr = shuffle(mode5JArr);

    drawTitle();
    initClick();
    mugCel = Math.floor(Math.random()*8);
    //nextQuestion();
}

function animate() {
    if (mode == 1 || mode == 5) {
        //
    } else if (mode == 3) {
        // kq
        drawBkgnd();
    } else if (mode == 4) {
        // pq
        drawBkgnd();
        drawPQ2Mug();    
    } else if (mode == 6) {
        // sq
        drawBkgnd();    
    }
    animateCounter()
    drawCounter();
}

function animateCounter() {
    // inc counter
    let counterVal = counterArray[1]*100+counterArray[3]*10+counterArray[5]+(counterArray[4]/15);
    
    if (score < 0) score = 0;
    if (score != counterVal) {
        // speed up if needed
        if (Math.abs(score-counterVal) > 5) {
            if (animationSpeed != 10) {
                stopAnimate();
                animationSpeed = animationSpeed - 10;
                startAnimate();
            }
        } else {
            if (animationSpeed != 100) {
                stopAnimate();
                animationSpeed ++;
                startAnimate();
            }
        }

        if (score < counterVal) {
            // count down

            counterArray[4] --;
            // left digit inc
            if (counterArray[4] < 0) {
                counterArray[5] --;
                counterArray[4] = 15;
                if (counterArray[5] < 0) {
                    counterArray[5] = 9;
                    counterArray[2] -- ; // inc middle d
                }
            }
            // middle digit
            if (counterArray[2] != 0) {
                counterArray[2] --;
                if (counterArray[2] < 0) {
                    counterArray[3] --;
                    counterArray[2] = 15;
                    if (counterArray[3] < 0) {
                        counterArray[3] = 9;
                        counterArray[0] -- ; // inc left d
                    }
                }
            }
            // left digit
            if (counterArray[0] != 0) {
                counterArray[0] --;
                if (counterArray[0] < 0) {
                    counterArray[1] --;
                    counterArray[0] = 15;
                    if (counterArray[1] < 0) {
                        // below 000
                        counterArray[1] = 9;
                    }
                }
            }
        } else {
            // count up

            counterArray[4] ++;
            // left digit inc
            if (counterArray[4] > 15) {
                counterArray[5] ++;
                counterArray[4] = 0;
                if (counterArray[5] > 9) {
                    counterArray[5] = 0;
                }
            }
            if (counterArray[5] == 9 && counterArray[4] == 2) {
                    counterArray[2] ++ ; // inc middle d
                }
            // middle digit
            if (counterArray[2] != 0) {
                if (counterArray[3] == 9 && counterArray[2] == 1) {
                    counterArray[0] ++;
                }
                counterArray[2] ++;
                if (counterArray[2] > 15) {
                    counterArray[3] ++;
                    counterArray[2] = 0;
                    if (counterArray[3] > 9) {
                        counterArray[3] = 0;
                    }
                }
            }
            // left digit
            if (counterArray[0] != 0) {
                    counterArray[0] ++;
                if (counterArray[0] > 15) {
                    counterArray[1] ++;
                    counterArray[0] = 0;
                    if (counterArray[1] > 9) {
                        // above 999 
                        counterArray[1] = 0;
                    }
                }
            }
        }
    }
}

function drawCounter() {
    let x = 500;
    let y = 20;
    if (mode == 3) {
        // kingsQuestions
        x = 570;
        y = 20;
    } else if (mode == 4) {
        // pq2
        x = 95;
        y = 190;
    } else if (mode == 5) {
        // lsl1vga
        x = 560;
        y = 20;
    } else if (mode == 6) {
        // sq3
        x = 12;
        y = 400;
    }
    for (let i = 0; i < 3; i++){
        let sx = counterArray[i*2] * 12 // Num's x loc on spritesheet
        let sy = counterArray[i*2+1] * 22 // Num's y loc on spritesheet
        let dx = x + (i * (11*2)); // 11*2 for 2x spacing
        ctx.drawImage(cNumImg, sx,sy, 11, 21, dx, y, 11*2, 21*2);
    } 
}

function drawKQShip() {

    kQShipImg = document.getElementById("rockSide");
    let x = 120;
    let y = 290;
    let celW;
    let celH;
    let sx;
    let sy;
    if (shipMode == 0) {
        // rockSide
        celW = 51;
        celH = 57; 
        sx = shipCel*(celW+1); //Num's x loc on spritesheet
        sy = 0 // one row, so always 0
    }
    //console.log("shipMode: " + shipMode);
    ctx.drawImage(kQShipImg, sx,sy, celW, celH, x, y, celW*1.25, celH*1.25);
    shipCel ++;
    if (shipCel > 7) {
        shipCel = 0;
    }
}

function drawSQ3grind() {
    kQShipImg = document.getElementById("sq3grind");
    let x = 362;
    let y = 376;
    let celW = 45;
    let celH = 15;
    let sx = grindCel*(celW);
    let sy = 0;

    ctx.drawImage(kQShipImg, sx,sy, celW, celH, x, y, celW*2, celH*2);
    grindCel ++;
    if (grindCel > 3) {
        grindCel = 0;
    }
}

function drawPQ2Mug() {

    pqMugImg = document.getElementById("pq2mug"); //39 x 52 x 8 mugs
    let x = 89;
    let y = 66;
    let celW;
    let celH;
    let sx;
    let sy;

    // mugshot
    celW = 38;
    celH = 52; 
    sx = mugCel*(celW+1); //Num's x loc on spritesheet
    sy = 0 // one row, so always 0
    ctx.drawImage(pqMugImg, sx,sy, celW, celH, x, y, celW*2, celH*2.25);

}


function startAnimate() {
    animateIntervalID = setInterval(animate, parseInt(animationSpeed, 10));
}

function stopAnimate() {
    clearInterval(animateIntervalID);
}


function scoreUpDown(v) {
    if (v == 1) {
        //score ++;
        score = score + 40;
    } else {
        //score --;
        score = score - 40;
    }
    drawBkgnd();
}

</script>

<br>
<button type="button" class="butt" onclick="langSel(1)">English</button>
<button type="button" class="butt" onclick="langSel(2)">Espa&#x00F1ol</button>
<button type="button" class="butt" onclick="langSel(3)">Fran&#231ais</button>
<button type="button" class="butt" onclick="langSel(4)">Deutsch</button>
<button type="button" class="butt" onclick="langSel(5)">Polski</button>
<!--button type="button" class="butt" onclick="switchLSLorOpenTrivia()">lsl3/OpenTrivia</button-->
<button type="button" class="butt" onclick="musicOnOff()">Music On/Off</button>
<!--button type="button" class="butt" onclick="scoreUpDown(1)">scoreUp</button>
<button type="button" class="butt" onclick="scoreUpDown(0)">scoreDown</button-->
</body>
</html>
